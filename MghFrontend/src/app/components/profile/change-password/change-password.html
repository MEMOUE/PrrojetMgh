<div class="change-password-container">
  <p-toast></p-toast>

  <!-- Header -->
  <div class="password-header">
    <div class="header-content">
      <div class="header-info">
        <h1 class="page-title">
          <i class="pi pi-key"></i>
          Changer le mot de passe
        </h1>
        <p class="page-subtitle">Modifiez le mot de passe de votre compte</p>
      </div>
    </div>
  </div>

  <!-- Form Content -->
  <div class="form-content">
    <p-card>
      <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
        
        <div class="form-grid">
          
          <!-- Ancien mot de passe -->
          <div class="form-field full-width">
            <label for="oldPassword" class="field-label">
              <i class="pi pi-lock"></i>
              Ancien mot de passe
              <span class="required">*</span>
            </label>
            <p-password
              id="oldPassword"
              formControlName="oldPassword"
              [feedback]="false"
              [toggleMask]="true"
              placeholder="Entrez votre ancien mot de passe"
              [inputStyle]="{'width': '100%'}"
              styleClass="w-full">
            </p-password>
            <small *ngIf="isFieldInvalid('oldPassword')" class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              {{ getFieldError('oldPassword') }}
            </small>
          </div>

          <!-- Nouveau mot de passe -->
          <div class="form-field full-width">
            <label for="newPassword" class="field-label">
              <i class="pi pi-lock"></i>
              Nouveau mot de passe
              <span class="required">*</span>
            </label>
            <p-password
              id="newPassword"
              formControlName="newPassword"
              [toggleMask]="true"
              placeholder="Entrez un nouveau mot de passe"
              [inputStyle]="{'width': '100%'}"
              styleClass="w-full"
              [strongRegex]="'^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{8,})'"
              promptLabel="Choisissez un mot de passe"
              weakLabel="Faible"
              mediumLabel="Moyen"
              strongLabel="Fort">
            </p-password>
            <small *ngIf="isFieldInvalid('newPassword')" class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              {{ getFieldError('newPassword') }}
            </small>
            <div *ngIf="passwordForm.get('newPassword')?.value && !isFieldInvalid('newPassword')" 
                 class="password-strength">
              <span class="strength-label">Force du mot de passe:</span>
              <span class="strength-indicator" [ngClass]="getPasswordStrengthClass()">
                {{ getPasswordStrength() }}
              </span>
            </div>
          </div>

          <!-- Confirmation du nouveau mot de passe -->
          <div class="form-field full-width">
            <label for="confirmPassword" class="field-label">
              <i class="pi pi-lock"></i>
              Confirmer le nouveau mot de passe
              <span class="required">*</span>
            </label>
            <p-password
              id="confirmPassword"
              formControlName="confirmPassword"
              [feedback]="false"
              [toggleMask]="true"
              placeholder="Confirmez le nouveau mot de passe"
              [inputStyle]="{'width': '100%'}"
              styleClass="w-full">
            </p-password>
            <small *ngIf="isFieldInvalid('confirmPassword') || passwordForm.errors?.['passwordMismatch']" 
                   class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              {{ getFieldError('confirmPassword') }}
            </small>
          </div>

          <!-- Indicateur de correspondance -->
          <div *ngIf="passwordForm.get('confirmPassword')?.value && 
                      passwordForm.get('newPassword')?.value === passwordForm.get('confirmPassword')?.value" 
               class="form-field full-width">
            <div class="password-match">
              <i class="pi pi-check-circle"></i>
              <span>Les mots de passe correspondent</span>
            </div>
          </div>

        </div>

        <!-- Actions -->
        <div class="form-actions">
          <button
            pButton
            type="button"
            label="Annuler"
            icon="pi pi-times"
            class="p-button-secondary p-button-outlined"
            (click)="onCancel()"
            [disabled]="submitting">
          </button>
          
          <button
            pButton
            type="submit"
            label="Changer le mot de passe"
            icon="pi pi-check"
            class="p-button-primary"
            routerLink=""
            [loading]="submitting"
            [disabled]="submitting || passwordForm.invalid">
          </button>
        </div>

      </form>
    </p-card>

    <!-- Conseils de sécurité -->
    <div class="security-tips">
      <div class="tips-header">
        <i class="pi pi-shield"></i>
        <h3>Conseils de sécurité</h3>
      </div>
      <ul class="tips-list">
        <li>
          <i class="pi pi-check"></i>
          Utilisez au moins 8 caractères
        </li>
        <li>
          <i class="pi pi-check"></i>
          Incluez des lettres majuscules et minuscules
        </li>
        <li>
          <i class="pi pi-check"></i>
          Ajoutez des chiffres et des caractères spéciaux
        </li>
        <li>
          <i class="pi pi-check"></i>
          N'utilisez pas d'informations personnelles
        </li>
        <li>
          <i class="pi pi-check"></i>
          Évitez les mots de passe faciles à deviner
        </li>
        <li>
          <i class="pi pi-check"></i>
          Changez régulièrement votre mot de passe
        </li>
      </ul>
    </div>
  </div>

</div>